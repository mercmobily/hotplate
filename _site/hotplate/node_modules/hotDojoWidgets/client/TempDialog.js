define( [

  "dojo/_base/declare"
, "dojo/topic"

, "dijit/form/Button"
, "dijit/Dialog"

], function(

  declare
, topic

, Button
, Dialog

){

  return declare( [ Dialog ], {

    startup: function(){
      this.inherited(arguments);
      this.show();
    },

    postCreate: function(){

      this.inherited(arguments);
      var self = this;

      if( this.hideOn ){
        // Honour the hideOn attribute
        topic.subscribe( this.hideOn, function(){
          self.hide();
        });
      };
    },

    // Hiding this widget will destroy it. This widget is good for disposable dialogs
    hide: function(){

      var self = this;
      var p = self.inherited(arguments);

      // Attach a new callback triggered when the animation is over:
      // the callback will destroy the widget
      if( p ) {
        var newPromise = p.then( function(){
          self.destroyRecursive();
        });
        return newPromise;
      } else {
        return p;
      }
      

    },

  });

});

